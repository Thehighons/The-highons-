<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="The Highon's - Premium creative supplies including keychains, art supplies, stationery, and diaries. Shop now for high-quality products.">
  <title>The Highon's - Creative Supplies | Premium Keychains, Art Materials & Stationery</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @font-face {
      font-family: 'Trajan Pro';
      /* Make sure these paths are correct relative to your HTML file or hosted */
      src: url('trajan-pro.woff2') format('woff2'), url('trajan-pro.woff') format('woff');
    }
    :root {
      --primary: #2A2D34;    /* Deep Navy */
      --secondary: #5C6B73;  /* Steel Blue */
      --accent: #D4A373;     /* Warm Gold */
      --dark: #1A1A1A;       /* Dark Text */
      --light: #F8F9FA;      /* Light Background */
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--light);
      color: var(--dark);
    }
    /* Prevent body scroll when cart is open */
    body.overflow-hidden {
      overflow: hidden;
    }

    h1, h2, h3 {
      font-family: 'Playfair Display', serif;
      color: var(--primary);
    }
    .brand-name {
      font-family: 'Trajan Pro', serif;
      letter-spacing: 1px;
      color: var(--primary);
    }
    .product-card {
      transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      background: white;
      border-radius: 12px;
      overflow: hidden;
      display: flex; /* Use flexbox for better structure */
      flex-direction: column;
      height: 100%; /* Make cards equal height in a grid row */
    }
    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    }
    .product-card-content {
        padding: 1rem; /* Use px-4 pb-4 equivalent */
        flex-grow: 1; /* Allow content to grow */
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* Push controls to bottom */
    }
    .product-card-controls {
        margin-top: auto; /* Pushes controls to the bottom */
    }
    .category-title {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 12px 32px;
      border-radius: 8px;
      display: inline-block;
      margin: 20px 0;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .nav-link {
      position: relative;
      color: var(--secondary);
      transition: all 0.3s ease;
    }
    .nav-link:hover {
      color: var(--primary);
    }
    .hero-gradient {
      background: linear-gradient(135deg, var(--light) 0%, #e2e8f0 100%);
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      transition: all 0.3s ease;
      color: white;
      border: none;
    }
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(42, 45, 52, 0.2);
    }
    /* Style for the filter dropdown */
    #categoryFilter {
      appearance: none;
      background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="%235C6B73"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>');
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 1.2em 1.2em;
      padding-right: 2.5rem; /* Make space for the arrow */
    }
    .feature-icon {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 10px rgba(42, 45, 52, 0.2);
    }
    .feature-card {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.08);
    }

    /* Cart Panel Styling */
    .cart-panel {
      background: white;
      box-shadow: -8px 0 32px rgba(0,0,0,0.1);
      position: fixed;
      top: 0;
      right: -100%; /* Start hidden off-screen */
      width: 380px;
      max-width: 90vw;
      height: 100vh;
      overflow-y: auto;
      z-index: 60; /* Above overlay, below modal */
      transition: right 0.4s ease-in-out;
      display: flex;
      flex-direction: column; /* Allow header/footer */
    }
    .cart-panel.open {
      right: 0; /* Slide in */
    }
    .cart-panel-content {
        flex-grow: 1;
        overflow-y: auto; /* Scroll only content */
        padding: 1.5rem; /* p-6 */
    }
    .cart-panel-footer {
        padding: 1.5rem; /* p-6 */
        border-top: 1px solid #e5e7eb; /* border-gray-200 */
        background-color: #f9fafb; /* bg-gray-50 */
    }

    /* Overlay Styling */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.4s ease-in-out, visibility 0.4s; /* Match opacity duration */
      z-index: 55; /* Below cart, above content */
    }
    .overlay.active {
      opacity: 1;
      visibility: visible;
      transition: opacity 0.4s ease-in-out; /* Only transition opacity */
    }

    .loader {
      border: 4px solid #f3f3f3; /* Light grey */
      border-top: 4px solid var(--primary); /* Blue */
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 40px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes float {
      0% { transform: translateY(0px) rotate(-2deg); }
      50% { transform: translateY(-15px) rotate(2deg); }
      100% { transform: translateY(0px) rotate(-2deg); }
    }
    .floating {
      animation: float 4s ease-in-out infinite;
    }
    .image-scale {
      transition: transform 0.4s ease;
    }
    .image-scale:hover {
      transform: scale(1.08);
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Navbar -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex items-center justify-between p-4">
      <div class="flex items-center">
        <span class="text-2xl font-bold tracking-wide brand-name">THE HIGHON'S</span>
      </div>
      <nav class="hidden md:flex items-center space-x-8">
        <a href="#products" class="nav-link">Products</a>
        <a href="#features" class="nav-link">Why Choose Us</a>
        <a href="#order" class="nav-link">Order</a>
        <a href="#request" class="nav-link">Request Product</a>
        <a href="#contact" class="nav-link">Contact</a>
        <div class="relative ml-4">
          <!-- DESKTOP CART BUTTON -->
          <button onclick="toggleCart()" class="flex items-center relative text-gray-600 hover:text-gray-800">
            <i class="fas fa-shopping-cart text-xl"></i>
            <span id="cartCounter" class="absolute -top-2 -right-2 bg-purple-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold hidden">0</span>
          </button>
        </div>
        <button id="logoutButtonDesktop" onclick="logout()" class="ml-4 text-sm btn-primary px-4 py-2 rounded-full hidden">Logout</button>
      </nav>
      <div class="md:hidden flex items-center space-x-4">
        <!-- MOBILE CART BUTTON -->
        <button onclick="toggleCart()" class="flex items-center relative text-gray-600 hover:text-gray-800">
          <i class="fas fa-shopping-cart text-xl"></i>
          <span id="cartCounterMobile" class="absolute -top-2 -right-2 bg-purple-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold hidden">0</span>
        </button>
        <button onclick="toggleMobileMenu()" class="text-gray-700">
          <i class="fas fa-bars text-2xl"></i>
        </button>
      </div>
    </div>
    <!-- Mobile Menu -->
    <div id="mobileMenu" class="hidden md:hidden bg-white border-t border-gray-200 p-4">
      <div class="flex flex-col space-y-4">
        <a href="#products" class="nav-link block py-2" onclick="toggleMobileMenu()">Products</a>
        <a href="#features" class="nav-link block py-2" onclick="toggleMobileMenu()">Why Choose Us</a>
        <a href="#order" class="nav-link block py-2" onclick="toggleMobileMenu()">Order</a>
        <a href="#request" class="nav-link block py-2" onclick="toggleMobileMenu()">Request Product</a>
        <a href="#contact" class="nav-link block py-2" onclick="toggleMobileMenu()">Contact</a>
        <button id="logoutButtonMobile" onclick="logout()" class="text-sm btn-primary px-4 py-2 rounded-full w-full mt-4 hidden">Logout</button>
      </div>
    </div>
  </header>

  <!-- Cart Panel -->
  <div class="overlay" id="cartOverlay" onclick="toggleCart()"></div>
  <div class="cart-panel" id="cartPanel">
      <div class="cart-panel-content">
          <div class="flex justify-between items-center mb-6">
              <h3 class="text-2xl font-bold text-gray-800">Your Cart</h3>
              <button onclick="toggleCart()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button> <!-- Consistent close button -->
          </div>
          <div id="cartPanelItems" class="space-y-4 mb-6">
            <!-- Cart items will be loaded here -->
            <p id="emptyCartMessage" class="text-center text-gray-500">Your cart is empty.</p>
          </div>
      </div>
      <div id="cartPanelFooter" class="cart-panel-footer hidden"> <!-- Initially hidden -->
          <div class="border-t border-gray-200 pt-4 mb-6">
              <div class="flex justify-between mb-2">
                  <span class="font-semibold">Subtotal:</span>
                  <span class="font-semibold">₹<span id="cartPanelSubtotal">0</span></span>
              </div>
              <div id="discountRow" class="flex justify-between mb-2 hidden">
                  <span class="font-semibold">Discount:</span>
                  <span class="font-semibold text-green-600">-₹<span id="cartPanelDiscount">0</span></span>
              </div>
              <div class="flex justify-between text-lg font-bold">
                  <span>Total:</span>
                  <span>₹<span id="cartPanelTotal">0</span></span>
              </div>
          </div>
          <div class="mb-4">
              <label class="block font-semibold mb-2 text-gray-700">Coupon Code:</label>
              <div class="flex">
                  <input type="text" id="cartCoupon" placeholder="Enter coupon code" class="flex-1 p-3 border border-gray-200 rounded-l-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                  <button onclick="applyCoupon()" class="bg-purple-600 text-white px-4 py-3 rounded-r-lg hover:bg-purple-700 transition">Apply</button>
              </div>
          </div>
          <button onclick="proceedToCheckout()" class="block w-full btn-primary text-white py-3 rounded-lg font-medium text-center">Proceed to Checkout</button>
      </div>
  </div>

  <!-- Hero Section -->
  <section class="text-center hero-gradient pt-20 pb-12">
    <div class="max-w-4xl mx-auto px-6">
      <img src="GridArt_20250425_064014157.png" alt="The Highon's Logo" class="logo mb-6 animate__animated animate__fadeIn w-48 mx-auto" loading="lazy">
      <h2 class="text-5xl font-bold mb-6 text-gray-800 animate__animated animate__fadeInDown">Create Bold. Create Bright.</h2>
      <p class="text-xl mb-10 text-gray-600 max-w-2xl mx-auto animate__animated animate__fadeIn animate__delay-1s">Welcome to The Highon's — where creativity meets purpose through premium supplies.</p>
      <a href="#products" class="inline-block btn-primary text-white px-10 py-4 rounded-full shadow-lg font-medium animate__animated animate__fadeIn animate__delay-2s">Explore Our Collection</a>
    </div>
    <div class="mt-12 flex justify-center space-x-8">
      <div class="floating animate__animated animate__fadeIn animate__delay-3s">
        <img src="Screenshot_20250422_132243_Meesho.jpg" alt="Keychain product" class="w-32 h-32 rounded-lg object-cover shadow-xl image-scale" loading="lazy">
      </div>
      <div class="floating animate__animated animate__fadeIn animate__delay-4s" style="animation-delay: 0.5s">
        <img src="Screenshot_20250424_134214_Meesho.jpg" alt="Art supplies" class="w-32 h-32 rounded-lg object-cover shadow-xl image-scale" loading="lazy">
      </div>
      <div class="floating animate__animated animate__fadeIn animate__delay-5s" style="animation-delay: 1s">
        <img src="81EROqfMQBL._AC_UF1000,1000_QL80_.jpg" alt="Diary product" class="w-32 h-32 rounded-lg object-cover shadow-xl image-scale" loading="lazy">
      </div>
    </div>
  </section>

  <!-- Features -->
  <section id="features" class="py-20 bg-gray-50 px-6">
    <div class="max-w-7xl mx-auto">
      <h2 class="text-4xl font-bold mb-12 text-center text-gray-800">Why Choose The Highon's</h2>
      <div class="grid md:grid-cols-3 gap-8">
        <div class="feature-card animate__animated">
          <div class="feature-icon">
            <i class="fas fa-award"></i>
          </div>
          <h3 class="text-xl font-bold mb-3 text-gray-800">Premium Quality</h3>
          <p class="text-gray-600">We source only the highest quality materials to ensure your creative projects shine.</p>
        </div>
        <div class="feature-card animate__animated">
          <div class="feature-icon">
            <i class="fas fa-truck"></i>
          </div>
          <h3 class="text-xl font-bold mb-3 text-gray-800">Local Delivery Only</h3>
          <p class="text-gray-600">Delivery within Navsari with careful packaging to protect your items.</p>
        </div>
        <div class="feature-card animate__animated">
          <div class="feature-icon">
            <i class="fas fa-headset"></i>
          </div>
          <h3 class="text-xl font-bold mb-3 text-gray-800">Dedicated Support</h3>
          <p class="text-gray-600">Our team is always ready to help with any questions about our products.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Products -->
  <section id="products" class="py-20 bg-white px-6">
    <div class="max-w-7xl mx-auto">
      <h2 class="text-4xl font-bold mb-6 text-center text-gray-800">Our Premium Collection</h2>
      <div class="flex flex-col md:flex-row justify-between items-center mb-10 gap-4">
          <div class="relative w-full md:w-1/2 lg:w-1/3">
            <input type="text" id="productSearch" placeholder="Search products..." class="w-full p-4 pl-12 border border-gray-200 rounded-full shadow-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div class="filter-selector text-center md:text-left">
            <label for="categoryFilter" class="mr-2 font-semibold text-gray-700">Filter by Category:</label>
            <select id="categoryFilter" class="p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white">
              <option value="all">All Products</option>
              <option value="keychains">Keychains</option>
              <option value="artSupplies">Art Supplies</option>
              <option value="stationery">Stationery</option>
              <option value="diaries">Diaries</option>
            </select>
          </div>
      </div>
      <div id="productsContainer" class="relative">
          <!-- Product cards will be loaded here -->
          <div class="loader"></div> <!-- Initial loader -->
      </div>
    </div>
  </section>

  <!-- Product Request Section -->
  <section id="request" class="py-20 bg-gray-50 px-6">
    <div class="max-w-2xl mx-auto text-center">
      <h2 class="text-4xl font-bold mb-8 text-gray-800">Request a Product</h2>
      <div class="product-request-form bg-white p-8 rounded-xl shadow-md">
        <form id="requestForm" action="https://formsubmit.co/thehighonsofficial@gmail.com" method="POST" class="space-y-6 text-left">
          <input type="hidden" name="_subject" value="New Product Request">
          <input type="hidden" name="_next" value="https://yourwebsite.com/thank-you.html"> <!-- CHANGE THIS URL -->
          <input type="hidden" name="_captcha" value="false">
          <div>
            <label for="requestName" class="block font-semibold mb-2 text-gray-700">Product Name</label>
            <input type="text" id="requestName" name="product" placeholder="What product are you looking for?" class="w-full p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
          </div>
          <div>
            <label for="requestDetails" class="block font-semibold mb-2 text-gray-700">Additional Details</label>
            <textarea id="requestDetails" name="details" rows="4" placeholder="Any specific brand, color, size or other details?" class="w-full p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"></textarea>
          </div>
          <div>
            <label for="requestEmail" class="block font-semibold mb-2 text-gray-700">Your Email</label>
            <input type="email" id="requestEmail" name="email" placeholder="Your email address" class="w-full p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
          </div>
          <button type="submit" class="w-full btn-primary text-white py-4 rounded-lg font-medium">Submit Request</button>
        </form>
      </div>
    </div>
  </section>

  <!-- Order Section -->
  <section id="order" class="py-20 bg-white px-6">
    <div class="max-w-2xl mx-auto text-center">
      <h2 class="text-4xl font-bold mb-8 text-gray-800">Place Your Order</h2>
      <div id="loginForm" class="space-y-6 text-left bg-white p-8 rounded-xl shadow-md">
        <h3 class="text-2xl font-semibold mb-6 text-gray-700">Your Information</h3>
        <input type="text" id="name" placeholder="Full Name" class="w-full p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
        <input type="email" id="email" placeholder="Email" class="w-full p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
        <input type="text" id="phone" placeholder="Phone (+91)" class="w-full p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
        <input type="text" id="address" placeholder="Full Address" class="w-full p-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
        <button onclick="saveUser()" class="w-full btn-primary text-white py-4 rounded-lg font-medium mt-4">Save & Continue</button>
      </div>
      <form id="orderForm" action="https://formsubmit.co/thehighonsofficial@gmail.com" method="POST" class="space-y-6 text-left bg-white p-8 rounded-xl shadow-md hidden">
        <input type="hidden" name="_next" value="https://yourwebsite.com/thank-you.html"> <!-- CHANGE THIS URL -->
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="name" id="formName">
        <input type="hidden" name="email" id="formEmail">
        <input type="hidden" name="phone" id="formPhone">
        <input type="hidden" name="address" id="formAddress">
        <input type="hidden" name="message" id="orderSummaryText">
        <h3 class="text-2xl font-semibold mb-6 text-gray-700">Order Summary</h3>
        <div class="mb-6">
          <label class="block font-semibold mb-2 text-gray-700">Have a coupon code?</label>
          <input type="text" id="coupon" placeholder="Enter code if you have one" class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
        </div>
        <div id="cartSummary" class="bg-gray-50 border border-gray-200 rounded-xl p-6 mb-6">
          <h3 class="font-semibold text-lg mb-4 text-gray-800">Your Cart Items</h3>
          <ul id="cartItems" class="space-y-3 mb-4"></ul>
          <div class="border-t border-gray-200 pt-4">
              <div id="summaryDiscountRow" class="flex justify-between mb-2 hidden">
                  <span class="font-semibold">Discount:</span>
                  <span class="font-semibold text-green-600">-₹<span id="summaryDiscount">0</span></span>
              </div>
              <p class="text-lg font-bold text-gray-800">Total: ₹<span id="cartTotal">0</span></p>
          </div>
        </div>
        <div class="mb-6">
          <label class="block font-semibold mb-2 text-gray-700">Payment Option:</label>
          <select name="payment" class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white">
            <option value="COD">Cash on Delivery</option>
            <option value="UPI">UPI Payment</option>
          </select>
        </div>
        <div class="text-center bg-gray-50 p-4 rounded-lg mb-6">
          <p class="font-semibold mb-3 text-gray-700">Scan to Pay via UPI:</p>
          <img src="1000022591.jpg" alt="UPI QR Code" class="w-48 mx-auto rounded-lg shadow" loading="lazy">
        </div>
        <button type="submit" onclick="return prepareOrder()" class="w-full btn-primary text-white py-4 rounded-lg font-medium">Confirm Order</button> <!-- Added return here -->
      </form>
      <p class="text-sm mt-6 text-gray-500">* Orders are only delivered within Navsari - 396445 *</p>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact" class="bg-gray-50 py-20 text-center px-6">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-4xl font-bold mb-8 text-gray-800">Get In Touch</h2>
      <div class="grid md:grid-cols-1 gap-8 text-left">
        <div class="bg-white p-8 rounded-xl shadow-sm">
          <h3 class="text-xl font-semibold mb-4 text-gray-800">Contact Information</h3>
          <p class="text-lg mb-2"><span class="font-medium">Email:</span> <a href="mailto:thehighonsofficial@gmail.com" class="text-purple-600 hover:text-purple-800">thehighonsofficial@gmail.com</a></p>
          <div class="flex space-x-4 mt-6">
            <a href="https://instagram.com/thehighons" target="_blank" class="text-gray-700 hover:text-purple-600 transition"><i class="fab fa-instagram text-2xl"></i></a>
            <!-- Add other social links here if needed -->
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12 mt-auto">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-6 md:mb-0 text-center md:text-left">
          <span class="text-2xl font-bold tracking-wide brand-name text-white">THE HIGHON'S</span>
          <p class="mt-2 text-gray-400">Innovating with Purpose</p>
        </div>
        <div class="flex flex-wrap justify-center gap-6">
          <a href="#products" class="text-gray-300 hover:text-white transition">Products</a>
          <a href="#features" class="text-gray-300 hover:text-white transition">Why Choose Us</a>
          <a href="#order" class="text-gray-300 hover:text-white transition">Order</a>
          <a href="#request" class="text-gray-300 hover:text-white transition">Request</a>
          <a href="#contact" class="text-gray-300 hover:text-white transition">Contact</a>
        </div>
      </div>
      <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-500 text-sm">
        <p>© 2024 The Highon's. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Modals -->
  <div id="productModal" class="fixed inset-0 z-[70] bg-black bg-opacity-50 flex items-center justify-center hidden p-4">
    <div class="bg-white p-8 rounded-xl shadow-2xl relative max-w-md w-full mx-auto animate__animated animate__zoomIn">
      <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl">×</button> <!-- Consistent close button -->
      <img id="modalImg" src="" alt="" class="w-full h-64 object-contain rounded-lg mb-6" loading="lazy">
      <h3 id="modalName" class="text-2xl font-bold mb-2 text-gray-800"></h3>
      <p id="modalDesc" class="text-gray-600 mb-4"></p>
      <p id="modalPrice" class="text-xl font-semibold text-purple-600 mb-6"></p>
      <button id="modalAddToCart" class="w-full btn-primary text-white py-3 rounded-lg font-medium">Add to Cart</button>
    </div>
  </div>

  <div id="orderConfirmation" class="fixed inset-0 z-[70] bg-black bg-opacity-50 flex items-center justify-center hidden p-4">
    <div class="bg-white p-8 rounded-xl shadow-2xl relative max-w-md w-full mx-auto text-center animate__animated animate__zoomIn">
      <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
        <i class="fas fa-check text-green-500 text-3xl"></i>
      </div>
      <h3 class="text-2xl font-bold mb-4 text-gray-800">Order Confirmed!</h3>
      <p class="text-gray-600 mb-6">Thank you for your purchase. We've received your order details.</p>
      <button onclick="closeOrderConfirmation()" class="btn-primary text-white px-8 py-3 rounded-lg font-medium">Continue Shopping</button>
    </div>
  </div>

  <script>
    // Products data (Ensure this is exactly as you had it)
    const products = {
         keychains: [
            { name: "Thor Loki Keychain", price: 99, img: "Screenshot_20250422_132243_Meesho.jpg", desc: "High-quality metal keychain featuring Thor and Loki designs" },
            { name: "Thor Hammer Keychain", price: 89, img: "Screenshot_20250422_131740_Meesho.jpg", desc: "Durable Mjolnir keychain with detailed engraving" },
            { name: "Demon slayer katana keychain", price: 159, img: "Screenshot_20250424_141150_Meesho.jpg", desc: "Miniature katana keychain from Demon Slayer anime" },
            { name: "Pikachu Keychain", price: 109, img: "Screenshot_20250422_131948_Meesho.jpg", desc: "Cute Pikachu keychain with enamel finish" }
        ],
        artSupplies: [
            { name: "Camel water colour tube", price: 169, img: "Screenshot_20250424_134214_Meesho.jpg", desc: "Professional-grade watercolor tubes, set of 12 vibrant colors" },
            { name: "FLAIR Acrylic marker", price: 359, img: "Screenshot_20250423_144509_Meesho.jpg", desc: "Premium acrylic paint markers, fine tip for detailed work" },
            { name: "Levin Acrylic Markers", price: 409, img: "Screenshot_20250423_140558_Meesho.jpg", desc: "Dual-tip acrylic markers with broad and fine tips" },
            { name: "Marker Set of 48", price: 299, img: "Touch-48-Color-Marker-Pen-Set-Kids-Art-Essentials-Double-Ended-Vibrant-Colors-Non-Bleeding-Wholesale-Discount-.webp", desc: "48-color marker set with dual tips for versatility" },
            { name: "Markers Set of 24", price: 179, img: "81B5uZXhYEL._AC_UF1000,1000_QL80_.jpg", desc: "24-color marker set, perfect for beginners" },
            { name: "Paint Brush 12 sizes", price: 89, img: "Screenshot_20250423_195924_Meesho.jpg", desc: "Professional paint brush set with 12 different sizes" },
            { name: "Sponge Dabbing Brush 5 Piece Set", price: 90, img: "41fvlzAzMWL._AC_.jpg", desc: "Sponge brush set for texture painting and special effects" },
            { name: "Camel artist gesso 100ml + Decor varnish combo", price: 259, img: "camel-combo.jpg", desc: "Premium gesso and varnish combo for professional art projects" }
        ],
        stationery: [
            { name: "correction tape", price: 70, img: "51l7S8XUY0L.jpg", desc: "Smooth correction tape for error-free writing" },
            { name: "Hot Melt Glue Gun", price: 220, img: "71xHhYjWcIL.jpg", desc: "20W glue gun with 5 glue sticks included" },
            { name: "Sketch Kit", price: 619, img: "Screenshot_20250423_205027_Meesho.jpg", desc: "Complete sketching kit with pencils, erasers and sharpeners" },
            { name: "luxury Pen", price: 199, img: "Screenshot_20250422_001401.jpg", desc: "Premium metal body pen with smooth ink flow" },
            { name: "Sketch book A5 100pg", price: 119, img: "Screenshot_20250423_204415_Meesho.jpg", desc: "A5 size sketchbook with 100gsm paper, 100 pages" }
        ],
        diaries: [
            { name: "Diary", price: 249, img: "81EROqfMQBL._AC_UF1000,1000_QL80_.jpg", desc: "Hardcover diary with premium paper and ribbon marker" },
            { name: "Diary Premium", price: 319, img: "IMG-20250422-WA0005.jpg", desc: "Premium leather-bound diary with lock and key" },
            { name: "Diary Mini", price: 219, img: "Screenshot_20250422_215326_Meesho.jpg", desc: "Compact pocket diary with elastic closure" },
            { name: "Vintage Handmade Genuine Leather Journal", price: 499, img: "vintage-journal.jpg", desc: "Premium handcrafted leather diary with handmade paper" }
        ]
    };

    let cart = JSON.parse(localStorage.getItem('cart')) || []; // Load cart from storage
    let currentModalProduct = null;
    let currentCategory = 'all';
    let appliedCoupon = null;

    // Core functions
    function renderProducts(category = 'all', searchTerm = '') {
        const container = document.getElementById("productsContainer");
        container.innerHTML = '<div class="loader"></div>'; // Show loader while rendering

        // Use setTimeout to allow loader to display before heavy computation
        setTimeout(() => {
            try {
                container.innerHTML = ''; // Clear loader/previous content
                let productsToRender = [];
                let hasProducts = false;

                const searchTermLower = searchTerm.toLowerCase();

                if (category === 'all') {
                    Object.entries(products).forEach(([catKey, items]) => {
                        const filtered = items.filter(item =>
                            item.name.toLowerCase().includes(searchTermLower) ||
                            item.desc.toLowerCase().includes(searchTermLower)
                        );
                        if (filtered.length > 0) {
                            hasProducts = true;
                            const section = document.createElement('div');
                            section.className = 'mb-16';
                            const title = catKey.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                            section.innerHTML = `
                                <h3 class="category-title">${title}</h3>
                                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8" id="${catKey}List"></div>
                            `;
                            container.appendChild(section); // Append section first
                            const grid = section.querySelector(`#${catKey}List`);
                            filtered.forEach((product) => {
                                const originalIndex = products[catKey].findIndex(p => p.name === product.name);
                                grid.appendChild(createProductCard(product, originalIndex, catKey));
                            });
                        }
                    });
                } else if (products[category]) {
                    const grid = document.createElement('div');
                    grid.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8';
                    const filtered = products[category].filter(item =>
                        item.name.toLowerCase().includes(searchTermLower) ||
                        item.desc.toLowerCase().includes(searchTermLower)
                    );

                    if (filtered.length > 0) {
                        hasProducts = true;
                        filtered.forEach((product) => {
                            const originalIndex = products[category].findIndex(p => p.name === product.name);
                            grid.appendChild(createProductCard(product, originalIndex, category));
                        });
                        container.appendChild(grid);
                    }
                }

                if (!hasProducts) {
                    container.innerHTML = '<p class="text-center text-gray-500 py-12 text-lg">No products found matching your criteria.</p>';
                } else {
                     animateCards(); // Animate cards after they are added
                }
            } catch (error) {
                console.error("Error rendering products:", error);
                container.innerHTML = '<p class="text-center text-red-500 py-12 text-lg">Error loading products. Please try again later.</p>';
            }
        }, 50); // Short delay
    }

    function createProductCard(product, index, category) {
        const card = document.createElement("div");
        card.id = `product-${category}-${index}`;
        card.className = "product-card animate__animated"; // Add base class for animation trigger

        const itemInCart = cart.find(item => item.name === product.name);

        card.innerHTML = `
            <div class="relative overflow-hidden rounded-t-lg h-56 bg-gray-100 flex items-center justify-center p-2">
                <img src="${product.img}" alt="${product.name}" class="max-w-full max-h-full object-contain transition duration-300 hover:scale-105 cursor-pointer" onclick="showModal('${category}', ${index})" loading="lazy">
            </div>
            <div class="product-card-content">
                 <div> <!-- Top content wrapper -->
                    <h3 class="text-lg font-semibold mb-1 text-gray-800">${product.name}</h3>
                    <p class="text-sm text-gray-500 mb-3 min-h-[40px]">${product.desc.substring(0, 50)}${product.desc.length > 50 ? '...' : ''}</p>
                    <span class="block text-xl font-bold text-purple-600 mb-4">₹${product.price}</span>
                </div>
                <div class="product-card-controls mt-auto"> <!-- Controls wrapper -->
                    ${itemInCart ? `
                        <div class="flex items-center justify-between gap-2">
                            <button onclick="updateQty('${category}', ${index}, -1)" class="bg-gray-200 text-gray-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-300 transition text-lg font-bold">-</button>
                            <span class="font-semibold text-gray-800 text-lg">${itemInCart.qty}</span>
                            <button onclick="updateQty('${category}', ${index}, 1)" class="bg-gray-200 text-gray-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-300 transition text-lg font-bold">+</button>
                        </div>` : `
                        <button onclick="addToCart('${category}', ${index})" class="w-full btn-primary text-white py-2 px-4 rounded-lg hover:shadow-md transition">Add to Cart</button>`
                    }
                </div>
            </div>
        `;
        return card;
    }

    // Cart functionality
    function addToCart(category, index) {
        try {
            const product = products[category][index];
            if (!product) {
                console.error("Product not found for:", category, index);
                return;
            }
            const existing = cart.find(p => p.name === product.name);

            if (existing) {
                existing.qty++;
            } else {
                // Add category and index to the item for easier reference later
                cart.push({ ...product, qty: 1, category: category, index: index });
            }

            saveCart();
            updateProductCard(category, index);
            updateCartUI();
        } catch (error) {
            console.error("Error adding to cart:", error);
        }
    }

    function updateQty(category, index, change) {
       try {
            const product = products[category]?.[index]; // Optional chaining
            if (!product) {
                console.error("Cannot update quantity, product not found for:", category, index);
                return;
            }
            const itemIndex = cart.findIndex(p => p.name === product.name);

            if (itemIndex > -1) {
                cart[itemIndex].qty += change;
                if (cart[itemIndex].qty <= 0) {
                    cart.splice(itemIndex, 1); // Remove item if quantity is zero or less
                }
                saveCart();
                updateProductCard(category, index); // Update the specific product card
                updateCartUI(); // Update cart panel and counters
            }
       } catch (error) {
            console.error("Error updating quantity:", error);
       }
    }

    // Update Product Card display (Add to cart vs +/- controls)
    function updateProductCard(category, index) {
        try {
            const product = products[category]?.[index];
            if (!product) return; // Product might not exist

            const cardId = `product-${category}-${index}`;
            const card = document.getElementById(cardId);
            if (!card) return; // Card might not be visible due to filtering

            const controlsContainer = card.querySelector('.product-card-controls');
            if (!controlsContainer) return;

            const itemInCart = cart.find(item => item.name === product.name);

            controlsContainer.innerHTML = itemInCart ? `
                <div class="flex items-center justify-between gap-2">
                    <button onclick="updateQty('${category}', ${index}, -1)" class="bg-gray-200 text-gray-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-300 transition text-lg font-bold">-</button>
                    <span class="font-semibold text-gray-800 text-lg">${itemInCart.qty}</span>
                    <button onclick="updateQty('${category}', ${index}, 1)" class="bg-gray-200 text-gray-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-300 transition text-lg font-bold">+</button>
                </div>` : `
                <button onclick="addToCart('${category}', ${index})" class="w-full btn-primary text-white py-2 px-4 rounded-lg hover:shadow-md transition">Add to Cart</button>`;
        } catch (error) {
            console.error(`Error updating product card for ${category}-${index}:`, error);
        }
    }

    // Combined function to update all cart-related UI elements
    function updateCartUI() {
        try {
            updateCartCounter();
            updateCartPanel();
            updateOrderSummary(); // Update the order form summary as well
        } catch(error) {
            console.error("Error updating cart UI:", error);
        }
    }

    function saveCart() {
        try {
            localStorage.setItem('cart', JSON.stringify(cart));
        } catch (error) {
            console.error("Error saving cart to localStorage:", error);
            // Optionally inform the user cart cannot be saved
        }
    }

    // Update Cart Panel (Side Panel)
    function updateCartPanel() {
        const panelItems = document.getElementById("cartPanelItems");
        const subtotalEl = document.getElementById("cartPanelSubtotal");
        const totalEl = document.getElementById("cartPanelTotal");
        const discountRow = document.getElementById("discountRow");
        const discountEl = document.getElementById("cartPanelDiscount");
        const emptyCartMsg = document.getElementById("emptyCartMessage");
        const cartFooter = document.getElementById("cartPanelFooter");

        if (!panelItems || !subtotalEl || !totalEl || !discountRow || !discountEl || !emptyCartMsg || !cartFooter) {
            console.error("One or more cart panel elements not found!");
            return;
        }

        panelItems.innerHTML = ''; // Clear previous items
        let subtotal = 0;

        try {
            if (cart.length === 0) {
                emptyCartMsg.classList.remove('hidden');
                cartFooter.classList.add('hidden');
                discountRow.classList.add('hidden');
                appliedCoupon = null; // Reset coupon if cart is empty
                const cartCouponInput = document.getElementById('cartCoupon');
                 if (cartCouponInput) cartCouponInput.value = ''; // Clear coupon input
            } else {
                emptyCartMsg.classList.add('hidden');
                cartFooter.classList.remove('hidden');

                cart.forEach(item => {
                    subtotal += item.price * item.qty;
                    // Minimal error checking for properties used in template
                    const itemName = item.name || 'Unknown Item';
                    const itemImg = item.img || 'placeholder.jpg'; // Provide a fallback image?
                    const itemPrice = item.price || 0;
                    const itemQty = item.qty || 0;

                    panelItems.innerHTML += `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg shadow-sm">
                            <div class="flex items-center space-x-3">
                                <img src="${itemImg}" alt="${itemName}" class="w-16 h-16 object-contain rounded border border-gray-200">
                                <div>
                                    <h4 class="font-medium text-sm">${itemName}</h4>
                                    <p class="text-xs text-gray-600">₹${itemPrice} x ${itemQty} = ₹${itemPrice * itemQty}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="updateQtyFromPanel('${itemName}', -1)"
                                        class="bg-gray-200 text-gray-700 w-7 h-7 rounded-full flex items-center justify-center hover:bg-gray-300 transition text-md font-bold">-</button>
                                <span class="mx-1 font-medium w-5 text-center">${itemQty}</span>
                                <button onclick="updateQtyFromPanel('${itemName}', 1)"
                                        class="bg-gray-200 text-gray-700 w-7 h-7 rounded-full flex items-center justify-center hover:bg-gray-300 transition text-md font-bold">+</button>
                            </div>
                        </div>
                    `;
                });

                subtotalEl.textContent = subtotal;

                // Recalculate total with coupon if applied
                let total = subtotal;
                let discount = 0;
                if (appliedCoupon === "NSL10%") {
                    discount = Math.round(subtotal * 0.10);
                    total = subtotal - discount;
                    discountEl.textContent = discount;
                    discountRow.classList.remove('hidden');
                } else {
                    discountRow.classList.add('hidden');
                }
                totalEl.textContent = total;
            }
        } catch (error) {
             console.error("Error updating cart panel content:", error);
             panelItems.innerHTML = '<p class="text-red-500">Error loading cart items.</p>';
             cartFooter.classList.add('hidden'); // Hide footer on error
        }
    }

    // Update quantity directly from Cart Panel
    function updateQtyFromPanel(name, change) {
        try {
            const item = cart.find(p => p.name === name);
            if (item) {
                // Prefer stored category/index if available
                 const category = item.category;
                 const index = item.index;

                 if(category !== undefined && index !== undefined && products[category]?.[index]?.name === name) {
                    // Use the more efficient updateQty if possible
                    updateQty(category, index, change);
                 } else {
                     // Fallback: find product category/index again (less efficient but robust)
                     let found = false;
                     for (const catKey in products) {
                         const originalIndex = products[catKey].findIndex(p => p.name === name);
                         if (originalIndex !== -1) {
                             updateQty(catKey, originalIndex, change);
                             found = true;
                             break;
                         }
                     }
                     if (!found) {
                         console.error("Could not find original product info for:", name, "during panel update.");
                         // If truly lost, update cart array directly as a last resort
                         const itemIndex = cart.findIndex(p => p.name === name);
                         if (itemIndex > -1) {
                             cart[itemIndex].qty += change;
                             if (cart[itemIndex].qty <= 0) {
                                 cart.splice(itemIndex, 1);
                             }
                             saveCart();
                             updateCartUI(); // Refresh everything
                         }
                     }
                 }
            } else {
                 console.warn("Item not found in cart for panel update:", name);
            }
        } catch (error) {
            console.error("Error in updateQtyFromPanel:", error);
        }
    }

    // Update Order Summary section on the main page
    function updateOrderSummary() {
      const list = document.getElementById("cartItems");
      const totalEl = document.getElementById("cartTotal");
      const summaryDiscountRow = document.getElementById("summaryDiscountRow");
      const summaryDiscountEl = document.getElementById("summaryDiscount");
      const orderForm = document.getElementById("orderForm");
      const couponInput = document.getElementById('coupon');

      if (!list || !totalEl || !summaryDiscountRow || !summaryDiscountEl || !orderForm || !couponInput) {
          console.error("One or more order summary elements not found!");
          return;
      }

      list.innerHTML = '';
      let total = 0;

       try {
            if (cart.length === 0) {
                list.innerHTML = '<li class="text-gray-500">Your cart is empty.</li>';
                totalEl.textContent = 0;
                summaryDiscountRow.classList.add('hidden');
            } else {
                cart.forEach(item => {
                    const itemPrice = item.price || 0;
                    const itemQty = item.qty || 0;
                    total += itemPrice * itemQty;
                    list.innerHTML += `
                        <li class="cart-item flex justify-between items-center text-sm">
                            <span>${item.name || 'Unknown Item'} (x${itemQty})</span>
                            <span class="font-semibold">₹${itemPrice * itemQty}</span>
                        </li>
                    `;
                });

                 // Apply coupon discount if active
                let finalTotal = total;
                let discount = 0;
                const coupon = couponInput.value.trim().toUpperCase(); // Use coupon from order form
                if (coupon === "NSL10%") { // Check order form coupon
                    discount = Math.round(total * 0.10);
                    finalTotal = total - discount;
                    summaryDiscountEl.textContent = discount;
                    summaryDiscountRow.classList.remove('hidden');
                } else {
                    summaryDiscountRow.classList.add('hidden');
                }
                totalEl.textContent = finalTotal;
            }
       } catch (error) {
            console.error("Error updating order summary:", error);
            list.innerHTML = '<li class="text-red-500">Error loading summary.</li>';
       }
    }


    // Update cart counters in header
    function updateCartCounter() {
      const counter = document.getElementById('cartCounter');
      const mobileCounter = document.getElementById('cartCounterMobile');
      if (!counter || !mobileCounter) return;

      try {
          const totalItems = cart.reduce((sum, item) => sum + (item.qty || 0), 0);

          counter.textContent = totalItems;
          mobileCounter.textContent = totalItems;

          counter.classList.toggle('hidden', totalItems === 0);
          mobileCounter.classList.toggle('hidden', totalItems === 0);
      } catch (error) {
          console.error("Error updating cart counter:", error);
      }
    }

    // ** THE KEY FUNCTION FOR OPENING/CLOSING **
    function toggleCart() {
      console.log("toggleCart called"); // DEBUG: Check if function executes
      const cartPanel = document.getElementById('cartPanel');
      const overlay = document.getElementById('cartOverlay');
      const body = document.body;

      if (!cartPanel || !overlay || !body) {
          console.error("Cart panel, overlay, or body element not found!");
          return;
      }

      const isOpen = cartPanel.classList.contains('open');

      try {
          if (isOpen) {
              console.log("Closing cart"); // DEBUG
              cartPanel.classList.remove('open');
              overlay.classList.remove('active');
              body.classList.remove('overflow-hidden');
          } else {
              console.log("Opening cart"); // DEBUG
              updateCartPanel(); // Update content *before* showing
              // Ensure updateCartPanel didn't fail silently before adding classes
              cartPanel.classList.add('open');
              overlay.classList.add('active');
              body.classList.add('overflow-hidden');
          }
      } catch (error) {
            console.error("Error toggling cart visibility:", error);
            // Attempt to reset state if error occurs during toggle
            cartPanel.classList.remove('open');
            overlay.classList.remove('active');
            body.classList.remove('overflow-hidden');
      }
    }


    function proceedToCheckout() {
        if (cart.length === 0) {
            alert("Your cart is empty. Please add items before proceeding to checkout.");
            return;
        }
        // Check if cart is open and close it first
        const cartPanel = document.getElementById('cartPanel');
        if (cartPanel && cartPanel.classList.contains('open')) {
            toggleCart();
        }
        // Use timeout to allow cart closing animation before scrolling
        setTimeout(() => {
             const orderSection = document.getElementById('order');
             if (orderSection) {
                orderSection.scrollIntoView({ behavior: 'smooth' });
                updateOrderSummary(); // Ensure summary is up-to-date when scrolling
             } else {
                 console.error("Order section not found!");
             }
        }, 450); // Slightly longer than CSS transition
    }

    function applyCoupon() {
        const couponInput = document.getElementById('cartCoupon');
        if (!couponInput) return;

        const couponCode = couponInput.value.trim().toUpperCase();

        if (couponCode === "NSL10%") {
            appliedCoupon = "NSL10%";
            alert('Coupon "NSL10%" applied successfully!');
        } else if (couponCode === "") {
             appliedCoupon = null; // Remove coupon
             alert('Coupon removed.');
        } else {
            appliedCoupon = null; // Reset if invalid
            alert('Invalid coupon code.');
            couponInput.value = ''; // Clear invalid code
        }
        updateCartPanel(); // Re-calculate totals in cart panel
    }

    function showModal(category, index) {
       try {
            if (!products[category] || !products[category][index]) {
                console.error("Product not found for modal:", category, index);
                return;
            }
            const product = products[category][index];
            currentModalProduct = { category, index, name: product.name };

            const modalImg = document.getElementById('modalImg');
            const modalName = document.getElementById('modalName');
            const modalDesc = document.getElementById('modalDesc');
            const modalPrice = document.getElementById('modalPrice');
            const productModal = document.getElementById('productModal');
            const modalBtn = document.getElementById('modalAddToCart');

            if (!modalImg || !modalName || !modalDesc || !modalPrice || !productModal || !modalBtn) {
                 console.error("One or more modal elements not found!");
                 return;
            }

            modalImg.src = product.img;
            modalName.textContent = product.name;
            modalDesc.textContent = product.desc;
            modalPrice.textContent = `₹${product.price}`;
            productModal.classList.remove('hidden');

            const itemInCart = cart.find(item => item.name === product.name);

            if (itemInCart) {
                modalBtn.textContent = `Update Quantity in Cart`; // Or keep 'Add to Cart'
                modalBtn.classList.add('bg-purple-700'); // Indicate it's already added/different action
                modalBtn.classList.remove('btn-primary'); // Use default btn-primary styles? Check CSS
            } else {
                modalBtn.textContent = 'Add to Cart';
                modalBtn.classList.remove('bg-purple-700');
                // Ensure btn-primary class is present if needed
                if (!modalBtn.classList.contains('btn-primary')) {
                     modalBtn.classList.add('btn-primary');
                }
            }
       } catch (error) {
            console.error("Error showing modal:", error);
       }
    }

    function closeModal() {
      const productModal = document.getElementById('productModal');
      if (productModal) {
        productModal.classList.add('hidden');
      }
      currentModalProduct = null; // Clear stored product
    }

    function addToCartFromModal() {
        if (currentModalProduct) {
            const { category, index } = currentModalProduct;
            if (category !== undefined && index !== undefined && products[category]?.[index]) {
                addToCart(category, index);
            } else {
                 console.error("Invalid category/index in currentModalProduct:", currentModalProduct);
            }
        } else {
             console.warn("Add to cart from modal called with no current product selected.");
        }
        closeModal(); // Close modal regardless
    }

    // Order processing functions
    function prepareOrder() {
        try {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) {
                alert("Please save your information before placing the order.");
                const loginForm = document.getElementById('loginForm');
                if (loginForm) loginForm.scrollIntoView({ behavior: 'smooth' });
                return false; // Prevent form submission
            }
            if (cart.length === 0) {
                alert("Your cart is empty. Cannot place order.");
                return false; // Prevent form submission
            }

            updateOrderSummary(); // Ensure totals are correct before generating summary

            const couponInput = document.getElementById('coupon');
            const paymentSelect = document.querySelector('select[name="payment"]');
            const orderSummaryText = document.getElementById("orderSummaryText");

            if (!couponInput || !paymentSelect || !orderSummaryText) {
                 console.error("Order form elements (coupon, payment, summary) missing!");
                 return false; // Prevent submission if essential fields are missing
            }

            const coupon = couponInput.value.trim().toUpperCase();
            let summary = `Order for: ${user.name}\nEmail: ${user.email}\nPhone: ${user.phone}\nAddress: ${user.address}\n\n--- Order Details ---\n`;
            let subtotal = 0;

            cart.forEach(item => {
                const itemPrice = item.price || 0;
                const itemQty = item.qty || 0;
                summary += `- ${item.name || 'Unknown Item'} (x${itemQty}): ₹${itemPrice * itemQty}\n`;
                subtotal += itemPrice * itemQty;
            });

            summary += `\nSubtotal: ₹${subtotal}\n`;
            let total = subtotal;

            if (coupon === "NSL10%") {
                const discount = Math.round(subtotal * 0.10);
                summary += `Discount (NSL10%): -₹${discount}\n`;
                total -= discount;
            }

            summary += `\n--- Total: ₹${total} ---\n`;
            summary += `Payment Method: ${paymentSelect.value}`;

            orderSummaryText.value = summary;

            // Simulate submission success for demo - IN PRODUCTION, RELY ON FORM ACTION RESPONSE
            setTimeout(() => {
                const orderConfirmation = document.getElementById('orderConfirmation');
                if (orderConfirmation) orderConfirmation.classList.remove('hidden');

                cart = []; // Clear the cart array
                saveCart(); // Save the empty cart to localStorage
                updateCartUI(); // Update all cart displays
                // Reset product cards to "Add to Cart" state
                 Object.keys(products).forEach(catKey => {
                     products[catKey].forEach((prod, idx) => updateProductCard(catKey, idx));
                 });
            }, 500); // Short delay before showing confirmation

            return true; // Allow form submission
        } catch (error) {
            console.error("Error preparing order:", error);
            alert("An error occurred while preparing your order. Please try again.");
            return false; // Prevent submission on error
        }
    }


    function closeOrderConfirmation() {
      const orderConfirmation = document.getElementById('orderConfirmation');
      if (orderConfirmation) orderConfirmation.classList.add('hidden');
      // Optional: Redirect or scroll
      // window.location.href = '#products';
    }

     function saveUser() {
      const nameInput = document.getElementById('name');
      const emailInput = document.getElementById('email');
      const phoneInput = document.getElementById('phone');
      const addressInput = document.getElementById('address');

      if (!nameInput || !emailInput || !phoneInput || !addressInput) {
           console.error("User info input fields not found!");
           return;
      }

      const name = nameInput.value.trim();
      const email = emailInput.value.trim();
      const phone = phoneInput.value.trim();
      const address = addressInput.value.trim();

      // Basic validation
      let isValid = true;
      const emailRegex = /^\S+@\S+\.\S+$/;
      const phoneRegex = /^[6-9]\d{9}$/; // Simple Indian mobile regex

      nameInput.classList.toggle('border-red-500', !name);
      emailInput.classList.toggle('border-red-500', !email || !emailRegex.test(email));
      phoneInput.classList.toggle('border-red-500', !phone || !phoneRegex.test(phone));
      addressInput.classList.toggle('border-red-500', !address);

      isValid = name && email && emailRegex.test(email) && phone && phoneRegex.test(phone) && address;

      if (!isValid) {
        alert("Please fill all fields correctly. Ensure email is valid and phone is a 10-digit Indian number starting with 6-9.");
        return;
      }

      try {
          localStorage.setItem('user', JSON.stringify({ name, email, phone, address }));
          alert("Information saved!");
          populateOrderForm(); // Show order form and hide login form
          updateLogoutButtonVisibility(); // Show logout button
      } catch (error) {
          console.error("Error saving user data to localStorage:", error);
          alert("Could not save your information. Please try again.");
      }
    }

    function populateOrderForm() {
        const loginForm = document.getElementById('loginForm');
        const orderForm = document.getElementById('orderForm');

        if (!loginForm || !orderForm) {
            console.error("Login or Order form not found!");
            return;
        }

        try {
            const userString = localStorage.getItem('user');
            if (userString) {
                const user = JSON.parse(userString);
                // Pre-fill hidden fields in the order form
                const formName = document.getElementById('formName');
                const formEmail = document.getElementById('formEmail');
                const formPhone = document.getElementById('formPhone');
                const formAddress = document.getElementById('formAddress');

                if (formName) formName.value = user.name;
                if (formEmail) formEmail.value = user.email;
                if (formPhone) formPhone.value = user.phone;
                if (formAddress) formAddress.value = user.address;

                // Hide login form, show order form
                loginForm.classList.add('hidden');
                orderForm.classList.remove('hidden');

                // Update the cart summary within the order form
                updateOrderSummary();
            } else {
                // Ensure login form is shown and order form is hidden if no user data
                loginForm.classList.remove('hidden');
                orderForm.classList.add('hidden');
            }
        } catch (error) {
             console.error("Error parsing user data or populating order form:", error);
             // Default to showing login form if error occurs
             loginForm.classList.remove('hidden');
             orderForm.classList.add('hidden');
        }
        updateLogoutButtonVisibility(); // Update logout button status
    }

    function logout() {
        try {
            localStorage.removeItem('user');
            localStorage.removeItem('cart'); // Also clear cart on logout
            cart = []; // Clear in-memory cart
            appliedCoupon = null; // Reset coupon
            alert("You have been logged out.");

            // Reset forms and UI
            const loginForm = document.getElementById('loginForm');
            const orderForm = document.getElementById('orderForm');
            if (loginForm) loginForm.classList.remove('hidden');
            if (orderForm) orderForm.classList.add('hidden');

            // Clear input fields
            const nameInput = document.getElementById('name');
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const addressInput = document.getElementById('address');
            if (nameInput) nameInput.value = '';
            if (emailInput) emailInput.value = '';
            if (phoneInput) phoneInput.value = '';
            if (addressInput) addressInput.value = '';

            updateLogoutButtonVisibility();
            updateCartUI(); // Clear cart display
             // Reset all product cards
            Object.keys(products).forEach(catKey => {
                products[catKey].forEach((prod, idx) => updateProductCard(catKey, idx));
            });
        } catch (error) {
            console.error("Error during logout:", error);
            // Still attempt to clear UI elements even if storage fails
            cart = [];
            updateCartUI();
            // etc.
        }
    }

    function updateLogoutButtonVisibility() {
        const logoutDesktop = document.getElementById('logoutButtonDesktop');
        const logoutMobile = document.getElementById('logoutButtonMobile');
        if (!logoutDesktop || !logoutMobile) return;

        try {
            const user = localStorage.getItem('user');
            logoutDesktop.classList.toggle('hidden', !user);
            logoutMobile.classList.toggle('hidden', !user);
        } catch (error) {
             console.error("Error checking user status for logout button:", error);
             // Default to hidden if error
             logoutDesktop.classList.add('hidden');
             logoutMobile.classList.add('hidden');
        }
    }

    function toggleMobileMenu() {
      const mobileMenu = document.getElementById('mobileMenu');
      if (mobileMenu) {
        mobileMenu.classList.toggle('hidden');
      }
    }

    // Initialization
    window.onload = () => {
      console.log("Window loaded. Initializing..."); // DEBUG
      try {
          renderProducts(); // Initial render
          populateOrderForm(); // Check for existing user data
          updateCartUI(); // Load cart display
          updateLogoutButtonVisibility(); // Set initial logout button state

          // Add event listeners
          const modalAddToCartButton = document.getElementById('modalAddToCart');
          if (modalAddToCartButton) {
              modalAddToCartButton.addEventListener('click', addToCartFromModal);
          } else {
              console.error("Modal AddToCart button not found on load.");
          }

          const productSearchInput = document.getElementById('productSearch');
          if (productSearchInput) {
              productSearchInput.addEventListener('input', function() {
                  renderProducts(currentCategory, this.value);
              });
          }

          const categoryFilterSelect = document.getElementById('categoryFilter');
          if (categoryFilterSelect) {
               categoryFilterSelect.addEventListener('change', function() {
                  currentCategory = this.value;
                  const searchVal = document.getElementById('productSearch')?.value || '';
                  renderProducts(currentCategory, searchVal);
              });
          }

          // Add listener for order form coupon input to update summary dynamically
          const couponInput = document.getElementById('coupon');
          if (couponInput) {
            couponInput.addEventListener('input', updateOrderSummary);
          }

          // Animate feature cards on scroll (simple example)
          const featureCards = document.querySelectorAll('.feature-card');
          if ('IntersectionObserver' in window) {
              const observerOptions = { threshold: 0.1 };
              const observer = new IntersectionObserver((entries, observer) => { // Pass observer to unobserve
                  entries.forEach(entry => {
                      if (entry.isIntersecting) {
                          entry.target.classList.add('animate__fadeInUp');
                          observer.unobserve(entry.target); // Animate only once
                      }
                  });
              }, observerOptions);
              featureCards.forEach(card => observer.observe(card));
          } else {
              // Fallback for older browsers: maybe just show them directly
              featureCards.forEach(card => card.classList.add('animate__fadeInUp'));
          }
          console.log("Initialization complete."); // DEBUG
      } catch (error) {
           console.error("Error during window.onload initialization:", error);
           alert("There was an error loading the page. Some features might not work correctly.");
      }
    };

    // Function to trigger card animations after rendering
    function animateCards() {
        // Use a staggered delay for entry animation
        try {
            const cards = document.querySelectorAll('#productsContainer .product-card');
             cards.forEach((card, index) => {
                card.style.opacity = '0'; // Start invisible
                card.style.animationDelay = `${index * 50}ms`;
                // Ensure animation class is added *after* potential re-renders
                setTimeout(() => {
                     card.style.opacity = '1';
                     card.classList.add('animate__fadeInUp');
                     // Optional: Remove animation class after it finishes to allow re-animation if needed
                     card.addEventListener('animationend', () => {
                         card.classList.remove('animate__fadeInUp');
                     }, { once: true });
                }, 20); // Small delay to ensure element is in DOM
            });
        } catch (error) {
            console.error("Error animating product cards:", error);
        }
    }

  </script>
</body>
</html>